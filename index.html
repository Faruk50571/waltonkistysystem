



<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>কিস্তি ম্যানেজার</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Kalpurush&display=swap');

    body {
      font-family: 'Kalpurush', Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
      color: #333;
    }
    h2, h3 {
      color: #006400;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
      background: #fff;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    th {
      background: #cce5cc;
      text-align: center;
    }
    button {
      cursor: pointer;
      border: none;
      padding: 6px 10px;
      margin: 2px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 14px;
    }
    .btn {
      transition: background-color 0.3s ease;
    }
    .btn-success {
      background-color: #28a745;
      color: white;
    }
    .btn-success:hover {
      background-color: #218838;
    }
    .btn-danger {
      background-color: #dc3545;
      color: white;
    }
    .btn-danger:hover {
      background-color: #c82333;
    }
    .btn-warning {
      background-color: #ffc107;
      color: black;
    }
    .btn-warning:hover {
      background-color: #e0a800;
    }
    input, textarea, select {
      width: 100%;
      padding: 6px 8px;
      margin: 6px 0 12px 0;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    textarea {
      resize: vertical;
      height: 60px;
    }
    .hidden {
      display: none;
    }
    #formSection, #notificationSection, #reportSection, #customerSection {
      background: white;
      padding: 15px;
      border-radius: 6px;
      box-shadow: 0 0 5px #aaa;
      margin-bottom: 30px;
    }
    #filterSection {
      margin-bottom: 15px;
    }
  </style>
</head>
<body>

  <h2>কিস্তি ম্যানেজার সফটওয়্যার</h2>

  <div>
    <button class="btn btn-success" onclick="showForm()">তথ্য যুক্ত করুন</button>
    <button class="btn btn-success" onclick="showCustomer()">গ্রাহক তথ্য যোগ</button>
    <button class="btn btn-warning" onclick="showNotification()">নোটিফিকেশন দেখুন</button>
    <button class="btn btn-warning" onclick="showReport()">রিপোর্ট দেখুন</button>
  </div>

  <!-- Customer Excel Upload Section -->
  <div id="customerSection" class="hidden">
    <h3>গ্রাহক তথ্য এক্সেল আপলোড করে যোগ করুন</h3>
    <input type="file" id="excelFile" accept=".xlsx, .xls" />
    <button class="btn btn-success" onclick="uploadExcel()">আপলোড করুন</button>
    <p id="uploadStatus"></p>
  </div>

  <!-- Notification Section -->
  <div id="notificationSection" class="hidden">
    <h3>নোটিফিকেশন</h3>
    <table id="notificationTable">
      <thead>
        <tr>
          <th>SL</th> <!-- এটি নতুন লাইন -->
      <th>Name</th>
      <th>Account</th>
      <th>Mobile</th>
      <th>Overdue</th>
      <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <!-- ডাইনামিক ডাটা এখানে আসবে -->
      </tbody>
    </table>
  </div>

  <!-- Report Section -->
  <div id="reportSection" class="hidden">
    <h3>সকল কিস্তির রিপোর্ট</h3>

    <div id="filterSection">
<label for="filterAccount">Filter by Account Number:</label>
      <input type="text" id="filterAccount" placeholder="Enter Account Number" oninput="loadReport()" />
    <!-- Filter by Date Range -->
<label for="startDate" style="margin-top:10px;">শুরুর তারিখ</label>
<input type="date" id="startDate" onchange="loadReport()" />

<label for="endDate" style="margin-top:10px;">শেষের তারিখ</label>
<input type="date" id="endDate" onchange="loadReport()" />
    </div>

    <table id="reportTable">
      <thead>
        <tr>
          <th>SL</th>
          <th>Name</th>
          <th>Account</th>
          <th>Mobile</th>
          <th>Overdue</th>
          <th>Date</th>
          <th>Comments</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <!-- ডাইনামিক ডাটা এখানে আসবে -->
      </tbody>
    </table>
    <button class="btn btn-success" onclick="exportToExcel()">Export to Excel</button>
    <button class="btn btn-success" onclick="exportToPDF()">Export to PDF</button>
  </div>

  <!-- Form Section -->
  <div id="formSection" class="hidden">
    <h3>কিস্তি তথ্য</h3>
    <input type="text" id="account" placeholder="একাউন্ট" oninput="fillCustomerDetails()" />
    <input type="text" id="name" placeholder="নাম" readonly />
    <input type="text" id="mobile" placeholder="মোবাইল" readonly />
    <input type="number" id="overdue" placeholder="ওভারডিউ" readonly />
    <input type="date" id="date" />
    <textarea id="comments" placeholder="মন্তব্য"></textarea>

    <button class="btn btn-success" id="saveBtn" onclick="saveSchedule()">সেভ করুন</button>
    <button class="btn btn-success hidden" id="updateBtn" onclick="updateSchedule()">আপডেট করুন</button>
    <button class="btn btn-danger" onclick="cancelEdit()">বাতিল করুন</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    let editIndex = null;

    function getCustomers() {
      return JSON.parse(localStorage.getItem('customers') || '[]');
    }
    function setCustomers(customers) {
      localStorage.setItem('customers', JSON.stringify(customers));
    }

    function fillCustomerDetails() {
      const account = document.getElementById('account').value.trim();
      const customers = getCustomers();
      const cust = customers.find(c => c.account === account);

      if(cust) {
        document.getElementById('name').value = cust.name;
        document.getElementById('mobile').value = cust.mobile;
        document.getElementById('overdue').value = cust.overdue;
      } else {
        document.getElementById('name').value = '';
        document.getElementById('mobile').value = '';
        document.getElementById('overdue').value = '';
      }
    }

    function uploadExcel() {
      const fileInput = document.getElementById('excelFile');
      const file = fileInput.files[0];
      if(!file) {
        alert("এক্সেল ফাইল নির্বাচন করুন");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const firstSheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[firstSheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, {defval: ''});

        let customers = getCustomers();

        jsonData.forEach(row => {
          if(row.Account && row.Name && row.Mobile) {
            const existingIndex = customers.findIndex(c => c.account === String(row.Account).trim());
            const newCustomer = {
              account: String(row.Account).trim(),
              name: String(row.Name).trim(),
              mobile: String(row.Mobile).trim(),
              overdue: row.Overdue ? String(row.Overdue).trim() : ''
            };
            if(existingIndex >= 0) {
              customers[existingIndex] = newCustomer;
            } else {
              customers.push(newCustomer);
            }
          }
        });

        setCustomers(customers);
        document.getElementById('uploadStatus').innerText = 'গ্রাহক তথ্য সফলভাবে আপলোড হয়েছে।';
        fileInput.value = '';
      };
      reader.readAsArrayBuffer(file);
    }

    function formatDate(dateStr) {
      if(!dateStr) return '';
      const d = new Date(dateStr);
      d.setMinutes(d.getMinutes() - d.getTimezoneOffset());
      return d.toISOString().split('T')[0];
    }

    function saveSchedule() {
      const account = document.getElementById('account').value.trim();
      const name = document.getElementById('name').value.trim();
      const mobile = document.getElementById('mobile').value.trim();
      const overdue = document.getElementById('overdue').value.trim();
      const date = document.getElementById('date').value;
      const comments = document.getElementById('comments').value.trim();

      if(!account || !name || !mobile || !date) {
        alert("একাউন্ট, নাম, মোবাইল ও তারিখ অবশ্যই পূরণ করতে হবে");
        return;
      }

      let schedules = JSON.parse(localStorage.getItem('schedules') || '[]');
      schedules.push({account, name, mobile, overdue, date, comments});
      localStorage.setItem('schedules', JSON.stringify(schedules));

      alert("কিস্তি তথ্য সংরক্ষণ করা হয়েছে");
      clearForm();
      showReport();
    }

    function showReport() {
      hideAllSections();
      document.getElementById('reportSection').classList.remove('hidden');
      loadReport();
    }

    function loadReport() {
  const schedules = JSON.parse(localStorage.getItem('schedules') || '[]');
  const tbody = document.querySelector('#reportTable tbody');
  tbody.innerHTML = '';
  const filterAccount = document.getElementById('filterAccount').value.trim();
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;

  schedules.forEach((item, index) => {
    const accountMatch = filterAccount === '' || item.account.includes(filterAccount);

    let dateMatch = true;
    if (startDate && endDate) {
      dateMatch = item.date >= startDate && item.date <= endDate;
    } else if (startDate) {
      dateMatch = item.date >= startDate;
    } else if (endDate) {
      dateMatch = item.date <= endDate;
    }

    if (accountMatch && dateMatch) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${index + 1}</td>
  <td>${item.name}</td>
  <td>${item.account}</td>
  <td>${item.mobile}</td>
  <td>${item.overdue}</td>
  <td>${item.date}</td>
  <td>${item.comments}</td>
        <td>
          <button onclick="editSchedule(${index})">সম্পাদনা</button>
          <button onclick="deleteSchedule(${index})">মুছুন</button>
        </td>
      `;
      tbody.appendChild(tr);
    }
  });
}

    function editSchedule(index) {
      let schedules = JSON.parse(localStorage.getItem('schedules') || '[]');
      const item = schedules[index];
      if(!item) return;

      document.getElementById('account').value = item.account;
      document.getElementById('name').value = item.name;
      document.getElementById('mobile').value = item.mobile;
      document.getElementById('overdue').value = item.overdue;
      document.getElementById('date').value = item.date;
      document.getElementById('comments').value = item.comments;

      editIndex = index;
      document.getElementById('saveBtn').classList.add('hidden');
      document.getElementById('updateBtn').classList.remove('hidden');
      showForm();
    }

    function updateSchedule() {
      if(editIndex === null) return alert("কোনো আইটেম সিলেক্ট করা হয়নি");

      const account = document.getElementById('account').value.trim();
      const name = document.getElementById('name').value.trim();
      const mobile = document.getElementById('mobile').value.trim();
      const overdue = document.getElementById('overdue').value.trim();
      const date = document.getElementById('date').value;
      const comments = document.getElementById('comments').value.trim();

      if(!account || !name || !mobile || !date) {
        alert("একাউন্ট, নাম, মোবাইল ও তারিখ অবশ্যই পূরণ করতে হবে");
        return;
      }

      let schedules = JSON.parse(localStorage.getItem('schedules') || '[]');
      schedules[editIndex] = {account, name, mobile, overdue, date, comments};
      localStorage.setItem('schedules', JSON.stringify(schedules));

      alert("কিস্তি তথ্য সফলভাবে আপডেট হয়েছে");
      editIndex = null;
      clearForm();
      showReport();
    }

    function deleteSchedule(index) {
      if(!confirm('আপনি কি সত্যিই এই কিস্তি মুছে ফেলতে চান?')) return;

      let schedules = JSON.parse(localStorage.getItem('schedules') || '[]');
      schedules.splice(index, 1);
      localStorage.setItem('schedules', JSON.stringify(schedules));
      loadReport();
    }

    function clearForm() {
      document.getElementById('account').value = '';
      document.getElementById('name').value = '';
      document.getElementById('mobile').value = '';
      document.getElementById('overdue').value = '';
      document.getElementById('date').value = '';
      document.getElementById('comments').value = '';
      document.getElementById('saveBtn').classList.remove('hidden');
      document.getElementById('updateBtn').classList.add('hidden');
    }

    function cancelEdit() {
      clearForm();
      editIndex = null;
      showReport();
    }

    function showForm() {
      hideAllSections();
      document.getElementById('formSection').classList.remove('hidden');
    }

    function showNotification() {
      hideAllSections();
      document.getElementById('notificationSection').classList.remove('hidden');
      loadNotification();
    }

    function showCustomer() {
      hideAllSections();
      document.getElementById('customerSection').classList.remove('hidden');
      document.getElementById('uploadStatus').innerText = '';
    }

    function hideAllSections() {
      document.getElementById('formSection').classList.add('hidden');
      document.getElementById('notificationSection').classList.add('hidden');
      document.getElementById('reportSection').classList.add('hidden');
      document.getElementById('customerSection').classList.add('hidden');
    }

    function loadNotification() {
      const today = new Date();
      const todayStr = today.toISOString().split('T')[0];
      const schedules = JSON.parse(localStorage.getItem('schedules') || '[]');
      const tbody = document.querySelector('#notificationTable tbody');
      tbody.innerHTML = '';

     let serial = 1;
schedules.forEach((item, index) => {
  if(item.date === todayStr) {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${serial++}</td>
      <td>${item.name}</td>
      <td>${item.account}</td>
      <td>${item.mobile}</td>
      <td>${item.overdue}</td>
      <td style="text-align:center;">
        <button class="btn btn-success" onclick="editSchedule(${index})">Edit</button>
        <button class="btn btn-danger" onclick="deleteSchedule(${index})">Delete</button>
      </td>
          `;
          tbody.appendChild(tr);
        }
      });
    }

    // Export to Excel using SheetJS
    function exportToExcel() {
  const filterAccount = document.getElementById('filterAccount').value.trim().toLowerCase();
  const startDate = document.getElementById('startDate').value;
  const endDate = document.getElementById('endDate').value;
  let schedules = JSON.parse(localStorage.getItem('schedules') || '[]');

  if (filterAccount) {
    schedules = schedules.filter(s => s.account.toLowerCase().includes(filterAccount));
  }
  if (startDate) {
    schedules = schedules.filter(s => s.date >= startDate);
  }
  if (endDate) {
    schedules = schedules.filter(s => s.date <= endDate);
  }

  if (schedules.length === 0) {
    alert("রিপোর্টে কোন ডাটা নেই");
    return;
  }

  const ws_data = [["SL", "Name", "Account", "Mobile", "Overdue", "Date", "Comments"]];
  schedules.forEach((item, index) => {
    ws_data.push([
      index + 1,
      item.name,
      item.account,
      item.mobile,
      item.overdue,
      formatDate(item.date),
      item.comments
    ]);
  });

  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(ws_data);
  XLSX.utils.book_append_sheet(wb, ws, "Report");
  XLSX.writeFile(wb, "installment_report.xlsx");
}


    // Export to PDF using jsPDF
    function exportToPDF() {
      const filterAccount = document.getElementById('filterAccount')?.value.trim().toLowerCase() || '';
      let schedules = JSON.parse(localStorage.getItem('schedules') || '[]');

      if(filterAccount) {
        schedules = schedules.filter(s => s.account.toLowerCase().includes(filterAccount));
      }
      if(schedules.length === 0) {
        alert("রিপোর্টে কোন ডাটা নেই");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(16);
      doc.text("কিস্তির রিপোর্ট", 14, 20);

      doc.setFontSize(10);
      const headers = ["Name", "Account", "Mobile", "Overdue", "Date", "Comments"];

      let startY = 30;
      const rowHeight = 7;
      const pageHeight = doc.internal.pageSize.height;

      doc.text(headers.join(" | "), 14, startY);
      startY += rowHeight;

      schedules.forEach(item => {
        const row = [
          item.name,
          item.account,
          item.mobile,
          item.overdue,
          formatDate(item.date),
          item.comments.length > 20 ? item.comments.substring(0, 17) + '...' : item.comments
        ].join(" | ");

        if(startY + rowHeight > pageHeight - 10) {
          doc.addPage();
          startY = 20;
          doc.text(headers.join(" | "), 14, startY);
          startY += rowHeight;
        }
        doc.text(row, 14, startY);
        startY += rowHeight;
      });

      doc.save("installment_report.pdf");
    }

  </script>

</body>
</html>
